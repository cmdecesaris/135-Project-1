---
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F)
```

\begin{center}
\vspace*{10\baselineskip}
\LARGE{\textbf{Project 1: PCA on a Birth Weight Dataset}}\\
\vspace*{19\baselineskip}
\normalsize{Trevor Carpenter, Christina De Cesaris, Michelle Tran}\\
STA 135: Multivariate Data Analysis\\
Professor Maxime Pouokam\\
University of California, Davis\\
May 4, 2021
\end{center}

\clearpage

```{r, warning = FALSE, message = FALSE}
library(factoextra)
library(knitr)
#data
smok = read.csv("data/Birthweight_reduced_kg_R.csv")
smok = smok[,2:14]

```

```{r}
new_print_loadings = function (x, digits = 3L, cutoff = 0.1, sort = FALSE, ...) 
{
  ## code from the original print.loadings function, without printing the variances
    Lambda <- unclass(x)
    p <- nrow(Lambda)
    factors <- ncol(Lambda)
    if (sort) {
        mx <- max.col(abs(Lambda))
        ind <- cbind(1L:p, mx)
        mx[abs(Lambda[ind]) < 0.5] <- factors + 1
        Lambda <- Lambda[order(mx, 1L:p), ]
    }
    fx <- setNames(format(round(Lambda, digits)), NULL)
    nc <- nchar(fx[1L], type = "c")
    fx[abs(Lambda) < cutoff] <- strrep(" ", nc)
    return(fx)
}

new_print_sum = function (x, digits = 3L, loadings = x$print.loadings, cutoff = x$cutoff, 
    ...) 
{
    vars <- x$sdev^2
    vars <- vars/sum(vars)
    return(rbind(`Standard deviation` = x$sdev, `Proportion of Variance` = vars, 
        `Cumulative Proportion` = cumsum(vars)))
}

```

# I. Introduction
Although low birth weighted infants can be healthy, under improper care or other circumstances, it can cause serious long-term health problems. A low birth weight is defined as being below 2.5kg. It can be caused by a multitude of factors \textemdash poor socioeconomic situation, premature birth, a mother's pre-existing health conditions, and more. In this project, we will highlight how smoking and other factors can cause low birth weights in infants in comparison to non-smoking parents. \
\
We want to find out what variables related to smoking and birth data are related to eachother and how strong those relationship is. In order to answer this, we will be using principal component analysis to analyze the data. PCA is a statistical technique that reduces a dimensionality of a dataset to make it interpretable while also preserving the variability of the data. [more explanation?] We can use it to see what variables group together, identify possible outliers, recognize correlations between variables, and more. 

# II. Summary of Data
Before conducting PCA onto a dataset, we must first examine the data and decide on what variables we want to specifically look at by looking at different plots and summaries.  \

```{r}
#Plots




```
The plot above shows.... \
\

When conducting the analysis, we also want to know if we want to use the covariance matrix or the correlation matrix. [Discuss the positive and negative aspects of using the covariance matrix for a PCA rather than the correlation matrix.]


# III. Analysis
If we compared babies according the their mother's smoking status, we can see what factors influence each other in both groups and compare them to see if they are different or similar. If there is a difference, it shows that a mother's smoking status does play a role in influencing their infant's growth. However, if they are similar, then something other than the mother's smoking status is causing a difference in an infant's growth. 

```{r, results = 'hide'}
######[If the overall goal is to compare babies according with their 
###### motherâ€™s smoking status, how would you proceed ?] 

#split the data
nonsmoke = subset(smok, smoker == 0, select = -c(5, 7))
smoke = subset(smok, smoker == 1, select = -c(5))

#pca and summary
##nonsmoking mothers
pca.nonsmoke =  princomp(nonsmoke, cor = TRUE)
t = summary(pca.nonsmoke, loadings = TRUE, cutoff = 0.1)$loadings


##smoking mothers
pca.smoke = princomp(smoke, cor = TRUE)
u = summary(pca.smoke, loadings = TRUE, cutoff = 0.1)$loadings

```

When analyzing the data via PCA, we found that both datasets only needed the first 6 PCs to achieve over 90% explanation of the variance. The majority of the variance is explained by the first PC at about 40% as seen from both scree plots below. From there it tapers off and after the 6th principal component, it reaches a plateau and each of the remaining PCs explains less than 3% of the total variance.

```{r, warning= F, message = F, fig.height= 3}
#scree plots for nonsmoking vs. smoking mothers datasets
library(factoextra)

fviz_eig(pca.nonsmoke, main = "Scree Plot for Non-Smoking Mothers Dataset")
fviz_eig(pca.smoke, main = "Scree Plot for Smoking Mothers Dataset")

```

The non-smoking mothers dataset shows that the first PC is based mainly on the positive correlation of body measurements of the baby, mother, and father; specifically, the gestation period, the parents' heights, and the infant's weight and length are the most significant here. This means that genetics and longer gestation period is correlated with a healthier baby. In comparison to the smoking mothers dataset, although they are similar, there is more emphasis on the parent's age than height. Overall, both confirm that gestation plays an important role in a healthier baby. 

For the second PC, in the non-smoking dataset, it was positively influenced by the parent's age. This highlights that both datasets agree that the parent's age is important in determining a healthy baby. For the smoking data set, the second PC negatively correlates the mother's height, pregnancy weight, and number of cigarettes together. This correlation is saying that an increase in these values means an unhealthy baby. But in PC 1 for the non-smoking dataset, a mother's height meant it would positively impact the baby's health. This confirms that smoking status does in fact effect a baby's health. 

\begin{center}
Non-Smoking Mothers Loadings\\
\end{center}
```{r}
kable(new_print_loadings(t, cutoff = 0.1)[,1:6])
```

\begin{center}
Smoking Mothers Loadings\\
\end{center}
```{r}
kable(new_print_loadings(u, cutoff = 0.1)[,1:6])
```

For PCs 3-6, the most notable similarity between the two groups is that they agree that the father's number of cigarettes has a negative influence on the health of the baby. In the smoking dataset, the father's characteristics\textemdash education and number of cigarettes\textemdash predominantly impacts the PCs negatively. Whereas in the non-smoking dataset, the significant variables seem relatively spread out across the PCs and it becomes harder to interpret them. 

Overall, because there is a difference in which variables impact the PCs, it highlights that a mother's smoking status does impact an infant's growth.

It is further notable that smoking is not beneficial for babies based on the PC analysis of the dataset as a whole. When the Principle Components are found on the dataset using the correlation matrix, we find the following:

```{r}
## PCA Analysis on whole data
c = princomp(smok, cor = TRUE)
l = summary(c, loadings = TRUE, cutoff = 0.15)$loadings
kable(new_print_sum(c, cutoff = 0.15)[,1:7])
kable(new_print_sum(c, cutoff = 0.15)[,8:13])
```

The number of PCs needed using the correlation matrix is only the first 8. Using only these 8 we are able to explain 92.56% of the variance of the data. 

This is further visualized using the following scree plot:

```{r, echo = FALSE}
fviz_eig(c, ncp = 13)
```

In this plot we are able to see that the elbow curve at the 8th dimension reflects the calculations results showing a need of only 8 dimensions to preserve at least 90% of the variance of the data.

Based on the loadings:
```{r}
kable(new_print_loadings(l, cutoff = 0.2)[,1:7])
kable(new_print_loadings(l, cutoff = 0.2)[,8:13])
```
we can see that when the physical features of the baby are all positive, as seen in the first four features of Comp. 1, 
```{r}
vars = l[,1][1:4]
kable(matrix(as.numeric(vars), ncol = length(vars)), col.names = names(vars))

```
that means that these features all correlate with eachother, meaning that a long gestation period is well correlated with a larger and healthier baby.

That said, when birthweight is positive and another score in the component is negative, as seen with smoker in Comp. 2:
```{r}
vars = c(l[,2]['Birthweight'], l[, 2]['smoker'])
kable(matrix(as.numeric(vars), ncol = length(vars)), col.names = names(vars))

``` 
that is a sign that the attribute of being a smoker is not beneficial for the baby, since it will impact the physical features.

As seen based on the PC analysis, these correlations become weaker as we iterate through the components This means that the later components contradicting that birthweight and smoking are actually the same sign score such as in Comp.11:
```{r}
vars = c(l[,11]['Birthweight'], l[, 11]['smoker'])
kable(matrix(as.numeric(vars), ncol = length(vars)), col.names = names(vars))

```
are negligible, since the later components explain very little proportion of the overall data variance.


We can also see that the number of cigarettes smoked per day by mother's and father's are both, as expected, well correlated with the smoking status of the mother. This is also visible with the mother and father's ages, as seen by the data in Comp.2:
```{r}
vars = c(l[,2][5:7], l[, 2][10], l[, 2][12])
kable(matrix(as.numeric(vars), ncol = length(vars)), col.names = names(vars))
```

Based on these Principle Components of the correlation matrix, it is clear that a larger gestational period is a beneficial thing for a baby's health, however a greater count of smoked cigarettes is not. It is also clear that the father's smoking status, as shown by the number of cigarettes he smokes per day, is well correlated with the mothers.

What is further interesting about this analysis is the lack of correlation of the physical attributes of the parents with the physical attributes of their newborn in comparison to that of the smoking features. While in Comp.1 we see that the physical features of the child and the physical features of the mother are similar scores:
```{r}
vars = c(l[,1][2:4], l[,1][8:9])
kable(matrix(as.numeric(vars), ncol = length(vars)), col.names = names(vars))
```
we see only three principle components later in Comp.4 a contradiction:
```{r}
vars = c(l[,4][2:4], l[,4][8:9])
kable(matrix(as.numeric(vars), ncol = length(vars)), col.names = names(vars))

```

This contradiction may be in a later component, however it is still a component that explains 8.7% of the overall variance of the data, and is relatively significant. It shows a reduced importance of the mother's physical features in explaining the physical features of her child, and a comparative increase in the impact of smoking.

# IV. Interpretation
Based on the analysis we can understand an estimation of what the physical features of a new baby not considered in this analysis will be using only a few features of the parents. For example, if the father is older he is more likely to smoke multiple cigarettes per day. In this case, based on the Principle Component Analysis we could expect that the mother also smokes multiple per day, and as such is marked as a smoker in the data. If this is in fact true we can predict that the gestation period will be shorter and the head circumference, birth weight, and length of this newborn baby will all be lower than expected. 

We would also see that the physical features of the father and mother such as their height and weight do not factor into the features of their child nearly as much as their actions do when it comes to smoking or not. Based on only these Principle Components we are able to understand how the smoking features of the father and mother have a direct impact on the features of their baby, and subsequently the healthiness of their baby.

```{r}
make_table = function(mat) {
}
```


```{r}
kable(matrix(c(61, 5.1, 36, 43, 0, 43, 7, 165, 64, 38), ncol = 10),  col.names = c("length", "birthweight", "headcirc", "gestation", "smoker", "motherage", "mnocig", "mheight", "mppwt", "fage"))
kable(matrix(c( 19, 45, 189), ncol = 3), col.names = c("fedyrs", "fnocig", "fheight"))
```


# V. Conclusion

Generally, this analysis shows that while physical features of the parents do explain the physical features of their children, features regarding their smoking habits is another very strong influence. We also see that the smoking actions of the father may correlate with the smoking actions of the mother, meaning that it is likely if one smokes so does the other. This is interesting because it disproves any assumption that the actions of the father do not influence the characteristics of his child.

In future analysis of this topic, it would be interesting to include alcohol consumption as another feature, as it has also been shown to have impacts on child gestation and birth features. We could also further analyze any correlation between the mother and father's non-physical features with each other, such as seeing if the more positive actions of the father in activities such as exercise or sleep influence the actions of the mother in similar ways that smoking does. Father's education level is also a feature in this dataset that does not correlate with other features and wasn't heavily analyzed, however maybe the addition of Mother's education level would show some deeper results.

```{r}

```


\subsection*{Appendix: R Script}

```{r, ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```
